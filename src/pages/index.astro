---
import Layout from '~/layouts/PageLayout.astro';
import { getCollection } from 'astro:content';

const metadata = {
  title: 'French Patent History Lab',
  ignoreTitleTemplate: true,
};

// Get projects, fellows and funders from collections
const projects = (await getCollection('projects'))
  .sort((a, b) => (a.data.order || 999) - (b.data.order || 999));

const fellows = (await getCollection('fellows'))
  .sort((a, b) => (a.data.order || 999) - (b.data.order || 999));

const funders = (await getCollection('funders'))
  .sort((a, b) => (a.data.order || 999) - (b.data.order || 999));
---
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>French Patent History Lab</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300&family=Source+Code+Pro:wght@300;400;600&display=swap" rel="stylesheet">
  <style is:global>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Source Code Pro', monospace;
    }

    /* Fixed position small logo (digiTatti style) */
    .fixed-logo {
      position: fixed;
      top: 10px;
      left: 10px;
      width: 20px;
      height: 20px;
      z-index: 1000;
    }

    .fixed-logo img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    /* Hero Section */
    .hero {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 2rem;
      position: relative;
    }

    .symbol-container {
      margin-top: 23px;
      margin-bottom: 10px;
      width: 140px;
      height: 140px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    /* Animated Logo Styles */
    .logo-animated,
    .logo-static {
      width: 100%;
      height: 100%;
      max-width: 140px;
      max-height: 140px;
      object-fit: contain;
      position: absolute;
      top: 0;
      left: 0;
    }

    .hero-title {
      font-size: 50pt;
      font-weight: 400;
      letter-spacing: 0.05em;
      margin-bottom: 1rem;
    }

    .hero-subtitle {
      font-size: 1.2rem;
      font-weight: 300;
      color: #666;
      margin-bottom: 3rem;
      line-height: 1.8;
      letter-spacing: 1px;
    }

    .scroll-indicator {
      position: absolute;
      bottom: 2rem;
      cursor: pointer;
    }

    .scroll-indicator svg {
      width: 30px;
      height: 30px;
      fill: #1a1a1a;
    }

    /* Section Styles - digiTatti style */
    .title-section {
      border-bottom: 1px solid #1a1a1a;
      margin: 100px 5% 100px 5%;
      font-size: 3.8em;
      font-weight: 400;
    }

    /* About Section - digiTatti style: 100vh, narrow column */
    .about-section {
      min-height: 100vh;
      font-size: 20pt;
      text-align: center;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .about-content {
      max-width: 60%;
      margin: 0 auto;
    }

    /* Projects Section - digiTatti masonry style */
    #projectsSection {
      padding-bottom: 100px;
      margin-bottom: 100px;
    }

    .projects-container {
      padding: 0 !important;
    }

    /* Clearfix for float layout */
    .projects-grid:after {
      content: '';
      display: block;
      clear: both;
    }

    .grid-item {
      float: left;
      padding: 30px;
      cursor: pointer;
    }

    .grid-item.small {
      width: 20%;
    }

    .grid-item.medium {
      width: 30%;
    }

    .grid-item.large {
      width: 40%;
    }

    .grid-item img {
      display: block;
      width: 100%;
      max-width: 100%;
      filter: grayscale(100%);
      transition: all 2s ease;
    }

    .grid-item:hover img {
      filter: grayscale(0%);
    }

    .project-title {
      font-size: 8pt;
      margin-top: 10px;
      font-weight: 600;
    }

    /* Responsive */
    @media (max-width: 767px) {
      .grid-item.small,
      .grid-item.medium,
      .grid-item.large {
        width: 50%;
      }
    }

    @media (max-width: 575px) {
      .grid-item.small,
      .grid-item.medium,
      .grid-item.large {
        width: 100%;
      }
    }

    /* Fellows Section */
    .fellows-section {
      /* No extra margin - title handles spacing */
    }

    .fellows-grid {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 5%;
      text-align: center;
    }

    .fellow-container {
      display: inline-block;
      width: 25%;
      text-align: center;
      cursor: pointer;
      vertical-align: top;
    }

    .fellow-image {
      display: block;
      border-radius: 50%;
      width: 200px;
      height: 200px;
      object-fit: cover;
    }

    .fellow-name {
      margin-top: 10px;
      margin-bottom: 30px;
    }

    /* Funders Section */
    .funders-section {
      background: #fafafa;
      margin-top: 100px;
      padding-bottom: 100px;
      padding-top: 100px;
    }

    .funders-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 3rem;
      max-width: 800px;
      margin: 0 auto;
      padding: 0 5%;
    }

    .funder-logo {
      padding: 2rem;
      background: #fff;
      border: 1px solid #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 120px;
    }

    .funder-logo img {
      max-width: 180px;
      filter: brightness(0) invert(0.15);
    }

    /* Contact Section - digiTatti style */
    .contact-container {
      padding-left: 5%;
      padding-right: 5%;
    }

    .contact-title {
      font-size: 14pt;
      margin-bottom: 20px;
    }

    .form-control {
      background-color: #F6F5F4;
      border: none;
      border-radius: 1px;
      padding: 1rem;
      font-family: 'Roboto', sans-serif;
      letter-spacing: 1px;
    }

    .form-control::placeholder {
      color: #8C8179;
    }

    .form-control:focus {
      outline: none;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    #formBtn {
      background-color: white;
      color: black;
      border: 1px solid black;
      border-radius: 1px;
      padding: 10px 40px 10px 40px;
      font-family: 'Roboto', sans-serif;
      letter-spacing: 1px;
      cursor: pointer;
    }

    #address {
      margin-top: 50px;
    }

    #address p {
      font-family: 'Roboto', sans-serif;
      font-weight: 300;
      line-height: 1.6;
    }

    /* Footer */
    .footer {
      margin-top: 200px;
      border-top: 1px solid #1a1a1a;
      padding: 10px 1%;
      height: 90px;
    }

    .footer-content {
      text-align: center;
    }

    .footer-logo {
      margin-bottom: 30px;
    }

    .footer-logo img {
      width: 40px;
      height: 40px;
      object-fit: contain;
    }

    .footer-text {
      font-family: 'Roboto', sans-serif;
      font-weight: 300;
      font-size: 10pt;
      margin-top: 30px;
    }

    /* Modals */
    .modal {
      display: none;
      position: fixed;
      z-index: 1050;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.5);
    }

    .modal.show {
      display: block;
    }

    .modal-dialog {
      max-width: 1000px;
      margin: 30px auto;
    }

    .modal-content {
      background: #fff;
      min-height: 70vh;
      padding: 80px;
      border: 0;
      border-radius: 0;
    }

    .modal-header {
      border-bottom: 0;
      padding: 0;
    }

    .modal-header .close {
      font-size: 50px;
      font-weight: 100;
      color: #1a1a1a;
      margin-right: -80px;
      opacity: 0.5;
      transition: opacity 0.3s;
    }

    .modal-header .close:hover {
      opacity: 1;
    }

    .modal-body {
      padding: 0;
    }

    #fellowModalImage {
      border-radius: 250px;
      width: 300px;
      height: 300px;
      object-fit: cover;
      margin: 0 auto 50px auto;
      display: block;
    }

    #fellowModalName {
      font-size: 20pt;
      font-family: 'Roboto', sans-serif;
      font-weight: bold;
    }

    #fellowModalBio {
      font-family: 'Roboto', sans-serif;
      text-align: justify;
      font-size: 12pt;
      letter-spacing: 1px;
      line-height: 18pt;
      margin-top: 50px;
    }

    #fellowModalBio:first-letter {
      color: #000000;
      float: left;
      font-family: 'Baskerville', serif;
      font-size: 75px;
      line-height: 60px;
      padding-top: 4px;
      padding-right: 8px;
      padding-left: 3px;
    }

    #projectModalImage {
      width: 100%;
      height: 300px;
      object-fit: cover;
      margin-bottom: 40px;
    }

    #projectModalTitle {
      margin-top: 40px;
      font-size: 17pt;
      font-weight: 300;
    }

    #projectModalDescription {
      font-size: 10pt;
      margin-top: 40px;
      margin-bottom: 40px;
      font-family: 'Roboto', sans-serif;
      letter-spacing: 1px;
      line-height: 18pt;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .hero-title {
        font-size: 30pt;
      }

      .about-content {
        max-width: 90%;
        font-size: 14pt;
      }

      .fellow-container {
        width: 50%;
      }

      .fellow-image {
        width: 150px;
        height: 150px;
      }

      .modal-content {
        padding: 30px;
      }

      #fellowModalImage {
        width: 200px;
        height: 200px;
      }

      .title-section {
        font-size: 2.5em;
        margin: 40px 5%;
      }
    }
  </style>
</head>
<body>
  <!-- Fixed position small logo -->
  <div class="fixed-logo">
    <img src="/images/fleur_lis_technical_drawing_logo.png" alt="Fleur-de-lis Logo" />
  </div>

  <!-- Hero Section -->
  <section class="hero">
    <div class="symbol-container">
      <!-- Animated Logo: Plays MP4 once on load, then switches to PNG -->
      <video
        id="heroLogoVideo"
        class="logo-animated"
        autoplay
        muted
        playsinline
        preload="auto"
        style="display: block;"
      >
        <source src="/images/fleur_lis_technical_drawing_logo.mp4" type="video/mp4">
      </video>
      <img
        id="heroLogoImage"
        class="logo-static"
        src="/images/fleur_lis_technical_drawing_logo.png"
        alt="French Patent History Lab Logo"
        style="display: none;"
      />
    </div>

    <h1 class="hero-title">French Patent History Lab</h1>
    <p class="hero-subtitle">
      the Lund University<br />
      research lab for<br />
      French historical patents
    </p>

    <div class="scroll-indicator" onclick="document.getElementById('about').scrollIntoView({behavior: 'smooth'})">
      <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
      </svg>
    </div>
  </section>

  <!-- About Section -->
  <section id="about" class="about-section">
    <div class="about-content">
      The French Patent History Lab serves as a research center dedicated to the study of French historical patents from the nineteenth century. We explore how intellectual property shaped technological progress during one of the most innovative periods in history.
    </div>
  </section>

  <!-- Projects Section -->
  <section id="projectsSection">
    <h2 class="title-section">Projects</h2>

    <div class="projects-container">
      <div class="projects-grid">
        {projects.map((project, index) => (
          <div class={`grid-item ${project.data.size}`} data-toggle="modal" data-target={`#projectModal${index}`}>
            <img src={project.data.image} alt={project.data.title}>
            <div class="project-title">{project.data.title}</div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Fellows Section -->
  <section id="fellows" class="fellows-section">
    <h2 class="title-section">Fellows</h2>

    <div class="fellows-grid">
      {fellows.map((fellow, index) => (
        <div class="fellow-container" data-toggle="modal" data-target={`#fellowModal${index}`}>
          <img class="fellow-image" src={fellow.data.image} alt={fellow.data.name}>
          <div class="fellow-name">{fellow.data.name}</div>
        </div>
      ))}
    </div>
  </section>

  <!-- Funders Section -->
  <section id="funders" class="funders-section">
    <h2 class="title-section">Funders</h2>

    <div class="funders-grid">
      {funders.map((funder) => (
        <div class="funder-logo">
          <img src={funder.data.logo} alt={funder.data.name} />
        </div>
      ))}
    </div>
  </section>

  <!-- Contact Section -->
  <section id="contact">
    <h2 class="title-section">Get in touch</h2>

    <div class="contact-container">
      <p class="contact-title">Please use the following form to reach out to us!</p>

      <form id="contactForm">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Name" required>
        </div>
        <div class="form-group">
          <input type="email" class="form-control" placeholder="Email" required>
        </div>
        <div class="form-group">
          <select class="form-control" required>
            <option value="">Select a subject</option>
            <option value="general">General Inquiry</option>
            <option value="collaboration">Research Collaboration</option>
            <option value="data">Data Access Request</option>
            <option value="media">Media Inquiry</option>
          </select>
        </div>
        <div class="form-group">
          <textarea class="form-control" placeholder="Message" rows="6" required></textarea>
        </div>
        <button type="submit" id="formBtn">Send Message</button>
      </form>

      <div id="address">
        <p><strong>French Patent History Lab</strong><br>
        Department of Economic History<br>
        Lund University School of Economics and Management<br>
        Lund, Sweden</p>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-logo">
        <img src="/images/fleur_lis_technical_drawing_logo.png" alt="French Patent History Lab Logo" />
      </div>

      <div class="footer-text">
        French Patent History Lab · Department of Economic History · Lund University School of Economics and Management<br>
        Lund, Sweden<br><br>
        © Lund University
      </div>
    </div>
  </footer>

  <!-- Fellow Modals -->
  {fellows.map((fellow, index) => (
    <div class="modal" id={`fellowModal${index}`} tabindex="-1" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">&times;</button>
          </div>
          <div class="modal-body">
            <img id="fellowModalImage" src={fellow.data.image} alt={fellow.data.name}>
            <div id="fellowModalName">{fellow.data.name}</div>
            <div id="fellowModalBio" set:html={fellow.rendered?.html} />
          </div>
        </div>
      </div>
    </div>
  ))}

  <!-- Project Modals -->
  {projects.map((project, index) => (
    <div class="modal" id={`projectModal${index}`} tabindex="-1" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">&times;</button>
          </div>
          <div class="modal-body">
            <img id="projectModalImage" src={project.data.image} alt={project.data.title}>
            <div id="projectModalTitle">{project.data.title}</div>
            <div id="projectModalDescription" set:html={project.rendered?.html} />
          </div>
        </div>
      </div>
    </div>
  ))}

  <script>
    // Simple modal functionality
    document.querySelectorAll('[data-toggle="modal"]').forEach(trigger => {
      trigger.addEventListener('click', function() {
        const targetId = this.getAttribute('data-target');
        const modal = document.querySelector(targetId);
        if (modal) {
          modal.classList.add('show');
        }
      });
    });

    document.querySelectorAll('.close').forEach(closeBtn => {
      closeBtn.addEventListener('click', function() {
        const modal = this.closest('.modal');
        if (modal) {
          modal.classList.remove('show');
        }
      });
    });

    document.querySelectorAll('.modal').forEach(modal => {
      modal.addEventListener('click', function(e) {
        if (e.target === modal) {
          modal.classList.remove('show');
        }
      });
    });

    // Form submission
    const form = document.getElementById('contactForm');
    form?.addEventListener('submit', function(e) {
      e.preventDefault();
      alert('Thank you for your message! We will get back to you soon.');
      (this as HTMLFormElement).reset();
    });

    // Animated Logo: Switch from video to static image after playback
    const logoVideo = document.getElementById('heroLogoVideo') as HTMLVideoElement;
    const logoImage = document.getElementById('heroLogoImage') as HTMLImageElement;

    if (logoVideo && logoImage) {
      // When video ends, switch to static image
      logoVideo.addEventListener('ended', function() {
        logoVideo.style.display = 'none';
        logoImage.style.display = 'block';
      });

      // Fallback: If video fails to load, show static image
      logoVideo.addEventListener('error', function() {
        logoVideo.style.display = 'none';
        logoImage.style.display = 'block';
      });

      // For users who prefer reduced motion, skip animation
      if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
        logoVideo.style.display = 'none';
        logoImage.style.display = 'block';
      }

      // On mobile, skip animation for better performance
      if (window.innerWidth < 768) {
        logoVideo.style.display = 'none';
        logoImage.style.display = 'block';
      }
    }
  </script>
</body>
</html>
